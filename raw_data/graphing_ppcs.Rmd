---
title: "PPCS Graphs"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load data}
library(tidyverse)
library(scales)
library(varhandle)

load("merged_ppcs.RData")
graph_ppcs <- merged_ppcs

```


```{r income bar graph}
# force graph comparing income and race

graph_ppcs$civilian_income <- recode_factor(graph_ppcs$civilian_income,
                                            "1" = '< $20,000',
                                            "2" = '$20,000 - $50,000',
                                            "3" = '> $50,000'
                                            )

graph_ppcs %>%
  filter(!is.na(civilian_income)) %>%
  group_by(civilian_income) %>%
  filter(force == 1) %>%
  ggplot() +
  geom_bar(aes(x = civilian_income, fill = civilian_race), color = "white", position = "dodge") +
  coord_flip() +
  xlab("Civilian Income") + 
  ylab("Number of Interactions Involving Force") +
  labs(fill = "Civilian Race") 

# white removed
graph_ppcs %>%
  filter(civilian_race != "white") %>% 
  filter(!is.na(civilian_income)) %>%
  group_by(civilian_income) %>%
  filter(force == 1) %>%
  ggplot() +
  geom_bar(aes(x = civilian_income, fill = civilian_race), color = "white", position = "dodge") +
  coord_flip() +
  xlab("Civilian Income") + 
  ylab("Number of Interactions Involving Force") +
  labs(fill = "Civilian Race")

```


```{r male and female graphs}
# force graph comparing gender
graph_ppcs$civilian_gender <- recode_factor(graph_ppcs$civilian_gender,
                                            "male" = 'Male',
                                            "female" = 'Female'
                                            )

graph_ppcs %>%
  group_by(year, civilian_gender) %>%
  mutate(year_count = n()) %>%
  filter(force == 1) %>%
  mutate(force_count = n()) %>%
  summarize(year_count = mean(year_count),
            force_count = mean(force_count)) %>%
  mutate(prop = force_count / year_count) %>%
  ggplot(aes(x = year, y = prop, color = civilian_gender, group = civilian_gender)) +
  geom_point(aes(size = year_count)) + 
  geom_line(lwd = 1.15) + 
  labs(color = "Civilian Gender", 
       size = " Number of Interactions\n Involving Force") +
  xlab("Year") + 
  ylab("Proportion of Use of Force")

```
```{r type of force by race}

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
